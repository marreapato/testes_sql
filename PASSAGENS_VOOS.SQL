--DROP TYPE MENOR_IDADE_TP;


----- tipos de objetos

CREATE OR REPLACE TYPE tp_endereco AS OBJECT(
    pais varchar2(15),
    cep varchar2(9),
    estado varchar2(15),
    cidade VARCHAR2(20),
    complemento varchar2(30)
);

--DROP TYPE tp_endereco;

CREATE OR REPLACE TYPE TP_FONE AS OBJECT (
    COD_PAIS VARCHAR(3),
    COD_DDD VARCHAR(5),
    PHONE VARCHAR(10)
);

CREATE OR REPLACE TYPE TP_FONES AS VARRAY(3) OF TP_FONE;

--DROP TYPE PASSAGEM_TP;
CREATE TYPE PASSAGEM_TP AS OBJECT(    
    pk_numero_passagem INTEGER,
    valor_passagem NUMBER(38,2),
    data_ida DATE,
    data_chegada DATE
);

CREATE TYPE TP_NT_PASSAGENS AS TABLE OF PASSAGEM_TP;

-- ENTIDADE VOO
CREATE OR REPLACE TYPE VOO_TP AS OBJECT(
    pk_localizador_voo NUMBER(38,0), -- trecho ID
    origem VARCHAR2(3),       -- origem IATA 3
    destino VARCHAR2(3),      -- destino IATA 3
    hora_embarque TIMESTAMP,
    hora_desembarque TIMESTAMP,
    PASSAGENS_LIST TP_NT_PASSAGENS
);

CREATE TABLE VOO_TABLE OF voo_tp (
    CONSTRAINT pkey_localizador_voo PRIMARY KEY (pk_localizador_voo)

) NESTED TABLE PASSAGENS_LIST STORE AS PASSAGENS_tab;


ALTER TABLE PASSAGENS_TAB MODIFY(

    CONSTRAINT PASSAGEM_PKEY PRIMARY KEY (PK_NUMERO_PASSAGEM)
);

INSERT INTO VOO_TABLE VALUES (1, 'GRU','BSB',TO_TIMESTAMP('08:20', 'HH24:,MI'),TO_TIMESTAMP('11:45','HH24:MI'), 
TP_NT_PASSAGENS(PASSAGEM_TP(1, 100.00, TO_DATE('2024-04-22', 'YYYY-MM-DD'), TO_DATE('2024-04-25', 'YYYY-MM-DD')),
PASSAGEM_TP(2, 150.00, TO_DATE('2024-05-01', 'YYYY-MM-DD'), TO_DATE('2024-05-05', 'YYYY-MM-DD')))
);

SELECT * FROM VOO_TABLE;

SELECT h.PK_LOCALIZADOR_VOO,
       e.DATA_IDA,
       e.DATA_CHEGADA,
       e.VALOR_PASSAGEM
FROM VOO_TABLE h,
     TABLE(h.PASSAGENS_list) e;

SELECT *
FROM TABLE(SELECT d.PASSAGENS_LIST
FROM VOO_TABLE d
WHERE d.PK_LOCALIZADOR_VOO = 1);

SELECT * FROM PASSAGENS_TAB;

-- Inserção de nova PASSAGEM
INSERT INTO TABLE (
    SELECT h.PASSAGENS_LIST
    FROM VOO_TABLE h
    WHERE PK_LOCALIZADOR_VOO = 1
)
VALUES (3, 100.00, TO_DATE('2024-04-22', 'YYYY-MM-DD'), TO_DATE('2024-04-25', 'YYYY-MM-DD'));

